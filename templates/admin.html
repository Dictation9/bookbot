<!DOCTYPE html>
<html>
<head>
    <title>BookBot Web GUI - Bot Scanner</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-4">
    <ul class="nav nav-tabs">
        <li class="nav-item"><a class="nav-link" href="/">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link active" href="/admin">Bot Scanner</a></li>
        <li class="nav-item"><a class="nav-link" href="/config">Config</a></li>
        <li class="nav-item"><a class="nav-link" href="/csv">CSV</a></li>
        <li class="nav-item"><a class="nav-link" href="/log">Log</a></li>
    </ul>
    <div class="mt-3">
        <h2>Bot Scanner</h2>
        <div class="mb-3">
            <button id="startScanBtn" class="btn btn-success me-2">Start Bluesky Scan</button>
            <button id="stopScanBtn" class="btn btn-danger me-2" disabled>Stop Scan</button>
            <span id="scanStatus" class="ms-3">Status: Idle</span>
        </div>
        <div class="mb-2">
            <span id="lastScan">Last Scan: Never</span>
        </div>
        <div class="mb-2">
            <span id="postCount">Posts to process: ...</span> |
            <span id="duplicateCount">Duplicates found: ...</span> |
            <span id="booksAdded">Books added to CSV: ...</span> |
            <span id="booksIgnored">Books ignored: ...</span>
        </div>
        <div class="mb-3">
            <label for="logOutput" class="form-label">Bluesky Log Output:</label>
            <pre id="logOutput" style="background:#222; color:#eee; padding:1em; border-radius:6px; max-height:300px; overflow:auto; font-size:13px;"></pre>
        </div>
    </div>
    <script>
    let scanRunning = false;
    let scanLogInterval = null;
    function updateScanStatus(status, color) {
        const el = document.getElementById('scanStatus');
        el.textContent = 'Status: ' + status;
        el.style.color = color || '';
    }
    function setScanButtons(running) {
        document.getElementById('startScanBtn').disabled = running;
        document.getElementById('stopScanBtn').disabled = !running;
    }
    function fetchScanLog() {
        fetch('/api/bluesky_scan_log').then(r => r.json()).then(data => {
            document.getElementById('logOutput').textContent = data.log || '';
            if (data.status) updateScanStatus(data.status, data.status_color);
            if (data.last_scan) document.getElementById('lastScan').textContent = 'Last Scan: ' + data.last_scan;
            if (data.post_count !== undefined) document.getElementById('postCount').textContent = 'Posts to process: ' + data.post_count;
            if (data.duplicate_count !== undefined) document.getElementById('duplicateCount').textContent = 'Duplicates found: ' + data.duplicate_count;
            if (data.books_added !== undefined) document.getElementById('booksAdded').textContent = 'Books added to CSV: ' + data.books_added;
            if (data.books_ignored !== undefined) document.getElementById('booksIgnored').textContent = 'Books ignored: ' + data.books_ignored;
        });
    }
    document.getElementById('startScanBtn').addEventListener('click', function() {
        fetch('/api/start_bluesky_scan', {method: 'POST'}).then(r => r.json()).then(data => {
            if (data.success) {
                scanRunning = true;
                setScanButtons(true);
                updateScanStatus('Running', 'green');
                scanLogInterval = setInterval(fetchScanLog, 2000);
            } else {
                updateScanStatus('Failed to start', 'red');
            }
        });
    });
    document.getElementById('stopScanBtn').addEventListener('click', function() {
        fetch('/api/stop_bluesky_scan', {method: 'POST'}).then(r => r.json()).then(data => {
            scanRunning = false;
            setScanButtons(false);
            updateScanStatus('Stopped', 'orange');
            if (scanLogInterval) clearInterval(scanLogInterval);
            fetchScanLog();
        });
    });
    // Initial fetch
    fetchScanLog();
    </script>
</div>
</body>
</html> 